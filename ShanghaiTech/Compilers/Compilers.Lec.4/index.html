
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../Compilers.Lec.3/">
      
      
        <link rel="next" href="../../DiscreteMathematics/DM.00%20Intro/">
      
      
      <link rel="icon" href="../../../assets/zambar.white.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.5">
    
    
      
        <title>编译原理 - Lecture 4 - ZAMBAR's Website</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/custom.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#-lecture-4" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="ZAMBAR&#39;s Website" class="md-header__button md-logo" aria-label="ZAMBAR's Website" data-md-component="logo">
      
  <img src="../../../assets/zambar.white.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ZAMBAR's Website
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              编译原理 - Lecture 4
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo"  aria-label="Light Mode Enabled"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Light Mode Enabled" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue-grey" data-md-color-accent="indigo"  aria-label="Dark Mode Enabled"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Dark Mode Enabled" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  Zebang He (ZAMBAR He)

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../links/" class="md-tabs__link">
        
  
    
  
  Links

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../tags/" class="md-tabs__link">
        
  
    
  
  Tags

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  ShanghaiTech

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../blog/" class="md-tabs__link">
          
  
  Blog

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="ZAMBAR&#39;s Website" class="md-nav__button md-logo" aria-label="ZAMBAR's Website" data-md-component="logo">
      
  <img src="../../../assets/zambar.white.png" alt="logo">

    </a>
    ZAMBAR's Website
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Zebang He (ZAMBAR He)
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../links/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Links
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tags/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tags
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    ShanghaiTech
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            ShanghaiTech
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Shanghai Tech
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    AZ Processer
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            AZ Processer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../AZ%20Processer/AZ.Chap.0%20Intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AZ.Chap.0 Intro
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2_2" id="__nav_4_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Chap.1 CPU的设计与实现
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_2">
            <span class="md-nav__icon md-icon"></span>
            Chap.1 CPU的设计与实现
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../AZ%20Processer/Chap.1%20CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/AZ.1.1.2%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    计算机系统
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../AZ%20Processer/Chap.1%20CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/AZ.1.1.3%20%E6%95%B0%E5%AD%97%E7%94%B5%E8%B7%AF%E5%9F%BA%E7%A1%80/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    数字电路基础
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../AZ%20Processer/Chap.1%20CPU%E7%9A%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/AZ.1.1.4%20Verilog%20HDL%20%E8%AF%AD%E8%A8%80/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Verilog HDL 语言
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CS100
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            CS100
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CS100/CS100.00%20Introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CS100/CS100.01%20The%20First%20C%20Program/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The First C Program
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CS100/CS100.01.Old%20C%20Program%20Structure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    C Program Structure
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CS100/CS100.02%20Variables%20I%20and%20Arithmetic%20Types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Variables I and Arithmetic Types
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CS100/CS100.10%20Summary%20of%20C/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Summary of C
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Compilers
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Compilers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Compilers.0%20Functional%20Programming/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    在开始之前——函数式初探
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Compilers.0%20OCaml/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OCaml 学习手记
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Compilers.Hw.1%20Hellocaml/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    编译原理 - Homework 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Compilers.Hw.2%20X86lite/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    编译原理 - Homework 2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Compilers.Lec.1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    编译原理 - Lecture 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Compilers.Lec.2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    编译原理 - Lecture 2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Compilers.Lec.3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    编译原理 - Lecture 3
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    编译原理 - Lecture 4
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    编译原理 - Lecture 4
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#implementing-x86lite" class="md-nav__link">
    <span class="md-ellipsis">
      Implementing X86lite
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementing X86lite">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#demo-handcoding-x86lite" class="md-nav__link">
    <span class="md-ellipsis">
      DEMO: Handcoding X86lite
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DEMO: Handcoding X86lite">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#assembler-syntax" class="md-nav__link">
    <span class="md-ellipsis">
      Assembler Syntax
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pretty-printing" class="md-nav__link">
    <span class="md-ellipsis">
      Pretty Printing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#programming-in-x86lite-storage" class="md-nav__link">
    <span class="md-ellipsis">
      Programming in X86lite - Storage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    DiscreteMathematics
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            DiscreteMathematics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DiscreteMathematics/DM.00%20Intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intro
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DiscreteMathematics/DM.8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lec.8 群
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DiscreteMathematics/DM.9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lec.9 离散对数
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6" >
        
          
          <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    HPC
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            HPC
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../HPC/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../HPC/HPC.SCC.01/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IndySCC Hw.1 - NAMD 与 Slurm 踩坑记
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../HPC/HPC.SCC.02/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IndySCC Hw.2
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7" >
        
          
          <label class="md-nav__link" for="__nav_4_7" id="__nav_4_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    LinearAlgebra
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7">
            <span class="md-nav__icon md-icon"></span>
            LinearAlgebra
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LinearAlgebra/LA.Review/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LA.Review
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_8" >
        
          
          <label class="md-nav__link" for="__nav_4_8" id="__nav_4_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    MathematicalAnalysis
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_8">
            <span class="md-nav__icon md-icon"></span>
            MathematicalAnalysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MathematicalAnalysis/MA.Add.02.%E7%A7%AF%E4%BD%AC%E4%BF%AE%E7%82%BC%E6%89%8B%E5%86%8C/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MA.Add.02.积佬修炼手册
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MathematicalAnalysis/MA.Add01.%E5%A5%87%E5%A5%87%E6%80%AA%E6%80%AA%E7%9A%84%E6%80%9D%E8%B7%AF%E5%92%8C%E6%8A%80%E5%B7%A7%EF%BC%81/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MA.Add01.奇奇怪怪的思路和技巧！
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MathematicalAnalysis/MA.Review.01/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MA.Review.01
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_9" >
        
          
          <label class="md-nav__link" for="__nav_4_9" id="__nav_4_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    MissingSemester
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_9">
            <span class="md-nav__icon md-icon"></span>
            MissingSemester
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MissingSemester/Missing.01%20Shell/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Shell
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MissingSemester/Missing.02%20Bash/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bash
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MissingSemester/Missing.03%20Vim/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vim
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MissingSemester/Missing.04%20Data%20Wrangling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    数据整理
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_10" >
        
          
          <label class="md-nav__link" for="__nav_4_10" id="__nav_4_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    OperatingSystem
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_10">
            <span class="md-nav__icon md-icon"></span>
            OperatingSystem
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OperatingSystem/CS130.01/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OS and Architecture Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OperatingSystem/CS130.02/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OS Services and Structures
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../OperatingSystem/CS130.Proj0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Proj.0: 正式上机前的环境配置
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_11" >
        
          
          <label class="md-nav__link" for="__nav_4_11" id="__nav_4_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    SI100B
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_11">
            <span class="md-nav__icon md-icon"></span>
            SI100B
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SI100B/Git%20Guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Git Guide
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Blog
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../blog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BLOGS!
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Archive
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../blog/archive/2024/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../blog/archive/2023/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Categories
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Categories
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../blog/category/docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../blog/category/esp32/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ESP32
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../blog/category/git/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Git
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../blog/category/others/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Others
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../blog/category/postgresql/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PostgreSQL
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../blog/category/si100b/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SI100B
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../blog/category/servo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Servo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../blog/category/shanghaitech/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ShanghaiTech
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../blog/category/tmux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tmux
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../blog/category/%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    智能家居
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#implementing-x86lite" class="md-nav__link">
    <span class="md-ellipsis">
      Implementing X86lite
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementing X86lite">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#demo-handcoding-x86lite" class="md-nav__link">
    <span class="md-ellipsis">
      DEMO: Handcoding X86lite
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DEMO: Handcoding X86lite">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#assembler-syntax" class="md-nav__link">
    <span class="md-ellipsis">
      Assembler Syntax
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pretty-printing" class="md-nav__link">
    <span class="md-ellipsis">
      Pretty Printing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#programming-in-x86lite-storage" class="md-nav__link">
    <span class="md-ellipsis">
      Programming in X86lite - Storage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  
<div><h1 id="-lecture-4">编译原理 - Lecture 4</h1>
<h2 id="implementing-x86lite">Implementing X86lite</h2>
<h3 id="demo-handcoding-x86lite">DEMO: Handcoding X86lite</h3>
<p>在 <code>lec4.zip</code> 里面，包含了一个最简单的 <code>x86LITE</code> 翻译套件。</p>
<p>例如，<code>main.ml</code> 里面会调用 <code>X86.string_of_prog</code> 将 <code>X86LITE</code> 语法转换为汇编代码字符串并输出，实际上， <code>p3</code> 的代码就是计算 <code>fact(6)</code> 的简单程序</p>
<p>我们来分析其中的一些部分操作</p>
<p>其中，<code>make</code> 生成的可执行文件 <code>test</code> 实际上是 <code>runtime.c</code> 与 <code>main.ml</code> 翻译成汇编的 <code>test.s</code> 二者连接生成的可执行文件，运行后会正确返回 <code>720</code></p>
<p>我们也可以看看 <code>test.s</code> 的代码：</p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="w">    </span><span class="na">.text</span><span class="w">                </span><span class="c1"># 指示接下来的指令属于代码段</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">    </span><span class="na">.globl</span><span class="w">  </span><span class="no">program</span><span class="w">      </span><span class="c1"># 定义 program, 使得 runtime.c 可以正常调用</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="nl">program:</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">    </span><span class="nf">movq</span><span class="w">    </span><span class="no">$1</span><span class="p">,</span><span class="w"> </span><span class="nv">%rax</span><span class="w">     </span><span class="c1"># 将通用累加器 (ans) 赋值为立即数 1</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">    </span><span class="nf">movq</span><span class="w">    </span><span class="no">$6</span><span class="p">,</span><span class="w"> </span><span class="nv">%rdi</span><span class="w">     </span><span class="c1"># 指针指向立即数 6</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">    </span><span class="na">.text</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="nl">loop:</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">    </span><span class="nf">cmpq</span><span class="w">    </span><span class="no">$0</span><span class="p">,</span><span class="w"> </span><span class="nv">%rdi</span><span class="w">     </span><span class="c1"># 比较 %rdi 与 0</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">    </span><span class="nf">je</span><span class="w">  </span><span class="no">exit</span><span class="w">             </span><span class="c1"># rdi == 0 =&gt; 跳到 exit</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">    </span><span class="nf">imulq</span><span class="w">   </span><span class="nv">%rdi</span><span class="p">,</span><span class="w"> </span><span class="nv">%rax</span><span class="w">   </span><span class="c1"># ans *= rax</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="w">    </span><span class="nf">decq</span><span class="w">    </span><span class="nv">%rdi</span><span class="w">         </span><span class="c1"># rdi --</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="w">    </span><span class="nf">jmp</span><span class="w"> </span><span class="no">loop</span><span class="w">             </span><span class="c1"># 循环</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="w">    </span><span class="na">.text</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="nl">exit:</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="w">    </span><span class="nf">retq</span><span class="w">                 </span><span class="c1"># 返回 (rax)</span>
</span></code></pre></div>
<h4 id="assembler-syntax">Assembler Syntax</h4>
<p>让我们来看看 <code>x86</code> 的基本解释代码</p>
<hr>
<p>首先定义了汇编的基本语法</p>
<div class="language-ocaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c">(* assembler syntax --------------------------------------------------------- *)</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="k">type</span> <span class="n">lbl</span> <span class="o">=</span> <span class="kt">string</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="k">type</span> <span class="n">quad</span> <span class="o">=</span> <span class="n">int64</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="k">type</span> <span class="n">imm</span> <span class="o">=</span> <span class="nc">Lit</span> <span class="k">of</span> <span class="n">quad</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>         <span class="o">|</span> <span class="nc">Lbl</span> <span class="k">of</span> <span class="n">lbl</span>
</span></code></pre></div>
<p>例如，标签是字符串，<code>quad</code> 代表 x86lite 仅有的数据类型 <code>int64</code>，立即数是 <code>quad</code>(<code>int64</code>) 的字面值 (<code>Lit</code> aka <code>int</code>)</p>
<hr>
<p>下面是关于寄存器和操作数的定义：</p>
<div class="language-ocaml highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c">(* arguments: rdi, rsi, rdx, rcx, r09, r08</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="c">   callee-save rbx, rbp, r12-r15 *)</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="k">type</span> <span class="n">reg</span> <span class="o">=</span> <span class="nc">Rip</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>         <span class="o">|</span> <span class="nc">Rax</span> <span class="o">|</span> <span class="nc">Rbx</span> <span class="o">|</span> <span class="nc">Rcx</span> <span class="o">|</span> <span class="nc">Rdx</span> <span class="o">|</span> <span class="nc">Rsi</span> <span class="o">|</span> <span class="nc">Rdi</span> <span class="o">|</span> <span class="nc">Rbp</span> <span class="o">|</span> <span class="nc">Rsp</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>         <span class="o">|</span> <span class="nc">R08</span> <span class="o">|</span> <span class="nc">R09</span> <span class="o">|</span> <span class="nc">R10</span> <span class="o">|</span> <span class="nc">R11</span> <span class="o">|</span> <span class="nc">R12</span> <span class="o">|</span> <span class="nc">R13</span> <span class="o">|</span> <span class="nc">R14</span> <span class="o">|</span> <span class="nc">R15</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="k">type</span> <span class="n">operand</span> <span class="o">=</span> <span class="nc">Imm</span> <span class="k">of</span> <span class="n">imm</span>            <span class="c">(* immediate *)</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>             <span class="o">|</span> <span class="nc">Reg</span> <span class="k">of</span> <span class="n">reg</span>            <span class="c">(* register *)</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>             <span class="o">|</span> <span class="nc">Ind1</span> <span class="k">of</span> <span class="n">imm</span>           <span class="c">(* indirect: displacement *)</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>             <span class="o">|</span> <span class="nc">Ind2</span> <span class="k">of</span> <span class="n">reg</span>           <span class="c">(* indirect: (%reg) *)</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>             <span class="o">|</span> <span class="nc">Ind3</span> <span class="k">of</span> <span class="o">(</span><span class="n">imm</span> <span class="o">*</span> <span class="n">reg</span><span class="o">)</span>   <span class="c">(* indirect: displacement(%reg) *)</span>
</span></code></pre></div>
<p>其中，<code>reg</code> 定义了几种寄存器，而操作数也有不同的匹配方法</p>
<hr>
<p>下面是对条件指令的定义</p>
<div class="language-ocaml highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c">(* Condition Codes *)</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="k">type</span> <span class="n">cnd</span> <span class="o">=</span> <span class="nc">Eq</span> <span class="o">|</span> <span class="nc">Neq</span> <span class="o">|</span> <span class="nc">Gt</span> <span class="o">|</span> <span class="nc">Ge</span> <span class="o">|</span> <span class="nc">Lt</span> <span class="o">|</span> <span class="nc">Le</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="k">type</span> <span class="n">opcode</span> <span class="o">=</span> <span class="nc">Movq</span> <span class="o">|</span> <span class="nc">Pushq</span> <span class="o">|</span> <span class="nc">Popq</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>            <span class="o">|</span> <span class="nc">Leaq</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>            <span class="o">|</span> <span class="nc">Incq</span> <span class="o">|</span> <span class="nc">Decq</span> <span class="o">|</span> <span class="nc">Negq</span> <span class="o">|</span> <span class="nc">Notq</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>            <span class="o">|</span> <span class="nc">Addq</span> <span class="o">|</span> <span class="nc">Subq</span> <span class="o">|</span> <span class="nc">Imulq</span> <span class="o">|</span> <span class="nc">Xorq</span> <span class="o">|</span> <span class="nc">Orq</span> <span class="o">|</span> <span class="nc">Andq</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>            <span class="o">|</span> <span class="nc">Shlq</span> <span class="o">|</span> <span class="nc">Sarq</span> <span class="o">|</span> <span class="nc">Shrq</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>            <span class="o">|</span> <span class="nc">Jmp</span>  <span class="o">|</span> <span class="nc">J</span> <span class="k">of</span> <span class="n">cnd</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>            <span class="o">|</span> <span class="nc">Cmpq</span>  <span class="o">|</span> <span class="nc">Set</span> <span class="k">of</span> <span class="n">cnd</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>            <span class="o">|</span> <span class="nc">Callq</span> <span class="o">|</span> <span class="nc">Retq</span>
</span></code></pre></div>
<p>然后定义了什么是指令、数据、汇编</p>
<div class="language-ocaml highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">type</span> <span class="n">ins</span> <span class="o">=</span> <span class="n">opcode</span> <span class="o">*</span> <span class="n">operand</span> <span class="kt">list</span>    
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="k">type</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Asciz</span> <span class="k">of</span> <span class="kt">string</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>          <span class="o">|</span> <span class="nc">Quad</span> <span class="k">of</span> <span class="n">imm</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="k">type</span> <span class="n">asm</span> <span class="o">=</span> <span class="nc">Text</span> <span class="k">of</span> <span class="n">ins</span> <span class="kt">list</span>    <span class="c">(* code *)</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>         <span class="o">|</span> <span class="nc">Data</span> <span class="k">of</span> <span class="n">data</span> <span class="kt">list</span>   <span class="c">(* data *)</span>
</span></code></pre></div>
<ul>
<li>指令，也就是 <code>机器码 * 操作数列表</code> 的元组</li>
<li>数据，可能是 <code>Asciz</code> 构造的字符串，也有可能是 <code>Quad</code> 构造的立即数</li>
<li>汇编，包含代码和数据，代码是指令的列表，数据是之前定义的 <code>data</code> 的列表</li>
</ul>
<hr>
<div class="language-ocaml highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c">(* labeled blocks of data or code *)</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="k">type</span> <span class="n">elem</span> <span class="o">=</span> <span class="o">{</span> <span class="n">lbl</span><span class="o">:</span> <span class="n">lbl</span><span class="o">;</span> <span class="n">global</span><span class="o">:</span> <span class="kt">bool</span><span class="o">;</span> <span class="n">asm</span><span class="o">:</span> <span class="n">asm</span> <span class="o">}</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="k">type</span> <span class="n">prog</span> <span class="o">=</span> <span class="n">elem</span> <span class="kt">list</span>
</span></code></pre></div>
<ul>
<li><code>elem</code> 代表数据或代码的带标签块，包含<ul>
<li>标签字符串</li>
<li>是否全局（涉及到作用域和生命周期）</li>
<li>含有的汇编代码</li>
</ul>
</li>
<li><code>prog</code> 代表整个程序，程序是 <code>elem</code> 构成的列表</li>
</ul>
<hr>
<h4 id="pretty-printing">Pretty Printing</h4>
<p>这部分是将中间表示转化为输出的部分，我们略作讲解</p>
<p>首先，是对寄存器的转换，<code>string_of_reg</code> 和 <code>string_of_byte_reg</code> 都是将对应的寄存器的字符串输出，需要注意，由于 <code>string_of_byte_reg</code> 将寄存器转换为字节级别的字符串，需要避免 <code>%rip</code> 的调用。</p>
<p>其次是对标签、立即数的转换。</p>
<p>接着是操作数的两种转换，除了寄存器调用的函数不同并无其他区别（唉唉，没有重写）</p>
<p>然后是解析 <code>jump</code> 的操作数：注意这里涉及到了地址的操作，需要解引用==（开头加入 <code>*</code>）==</p>
<p>条件后缀和 <code>opcode</code> 的解析，非常简单。</p>
<hr>
<p>后面的开始有意思起来了</p>
<p>先是定义了一个工具函数 <code>map_contact</code></p>
<div class="language-ocaml highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">let</span> <span class="n">map_concat</span> <span class="n">s</span> <span class="n">f</span> <span class="n">l</span> <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">concat</span> <span class="n">s</span> <span class="o">@@</span> <span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="n">f</span> <span class="n">l</span>
</span></code></pre></div>
<ul>
<li>用于对一个列表 <code>l</code> 应用 <code>f</code> 进行映射，然后将结果中间加入 <code>s</code> 连接成字符串</li>
</ul>
<p>然后是 <code>string_of_shift</code> 函数，用来处理移位相关的指令，将其转换为字符串</p>
<div class="language-ocaml highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="k">let</span> <span class="n">string_of_shift</span> <span class="n">op</span> <span class="o">=</span> <span class="k">function</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>  <span class="o">|</span> <span class="o">[</span> <span class="nc">Imm</span> <span class="n">i</span> <span class="o">;</span> <span class="n">dst</span> <span class="o">]</span> <span class="k">as</span> <span class="n">args</span> <span class="o">-&gt;</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>    <span class="s2">"</span><span class="se">\t</span><span class="s2">"</span> <span class="o">^</span> <span class="n">string_of_opcode</span> <span class="n">op</span> <span class="o">^</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">"</span> <span class="o">^</span> <span class="n">map_concat</span> <span class="s2">", "</span> <span class="n">string_of_operand</span> <span class="n">args</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>  <span class="o">|</span> <span class="o">[</span> <span class="nc">Reg</span> <span class="nc">Rcx</span> <span class="o">;</span> <span class="n">dst</span> <span class="o">]</span> <span class="o">-&gt;</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>    <span class="nn">Printf</span><span class="p">.</span><span class="n">sprintf</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">%s</span><span class="se">\t</span><span class="s2">%%cl, %s"</span> <span class="o">(</span><span class="n">string_of_opcode</span> <span class="n">op</span><span class="o">)</span> <span class="o">(</span><span class="n">string_of_operand</span> <span class="n">dst</span><span class="o">)</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>  <span class="o">|</span> <span class="n">args</span> <span class="o">-&gt;</span> <span class="n">failwith</span> <span class="o">(</span><span class="nn">Printf</span><span class="p">.</span><span class="n">sprintf</span> <span class="s2">"shift instruction has invalid operands: %s</span><span class="se">\n</span><span class="s2">"</span> 
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>                     <span class="o">(</span><span class="n">map_concat</span> <span class="s2">", "</span> <span class="n">string_of_operand</span> <span class="n">args</span><span class="o">))</span>
</span></code></pre></div>
<ul>
<li>首先是这个颇具特色的函数的定义，相当于模式匹配了三个函数（重载是吧）</li>
<li>然后是各种匹配，分别对应参数为<ul>
<li>立即数+操作数 -&gt; <code>&lt;op&gt;  &lt;i&gt;, &lt;op-dst&gt;</code></li>
<li>寄存器+操作数 -&gt; <code>&lt;op&gt;  %cl, &lt;op-dst&gt;</code> <mark>是否只有 <code>%rcx</code> 能够直接位移？</mark></li>
<li>其它 -&gt; 报错</li>
</ul>
</li>
</ul>
<hr>
<p>而我们看看如何将 instruction 翻译到 asm string</p>
<div class="language-ocaml highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="k">let</span> <span class="n">string_of_ins</span> <span class="o">(</span><span class="n">op</span><span class="o">,</span> <span class="n">args</span><span class="o">:</span> <span class="n">ins</span><span class="o">)</span> <span class="o">:</span> <span class="kt">string</span> <span class="o">=</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>  <span class="k">match</span> <span class="n">op</span> <span class="k">with</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>  <span class="o">|</span> <span class="nc">Shlq</span> <span class="o">|</span> <span class="nc">Sarq</span> <span class="o">|</span> <span class="nc">Shrq</span> <span class="o">-&gt;</span> <span class="n">string_of_shift</span> <span class="n">op</span> <span class="n">args</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>  <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>  <span class="k">let</span> <span class="n">f</span> <span class="o">=</span> <span class="k">match</span> <span class="n">op</span> <span class="k">with</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>    <span class="o">|</span> <span class="nc">J</span> <span class="o">_</span> <span class="o">|</span> <span class="nc">Jmp</span> <span class="o">|</span> <span class="nc">Callq</span> <span class="o">-&gt;</span> <span class="n">string_of_jmp_operand</span> 
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>    <span class="o">|</span> <span class="nc">Set</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">string_of_byte_operand</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>    <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">string_of_operand</span> 
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>  <span class="k">in</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>  <span class="s2">"</span><span class="se">\t</span><span class="s2">"</span> <span class="o">^</span> <span class="n">string_of_opcode</span> <span class="n">op</span> <span class="o">^</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">"</span> <span class="o">^</span> <span class="n">map_concat</span> <span class="s2">", "</span> <span class="n">f</span> <span class="n">args</span>
</span></code></pre></div>
<p>首先会判断，如果是位移相关就交给 <code>string_of_shift</code> ，否则再处理其他的，因为位移的输出不太相同。</p>
<div class="language-ocaml highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">let</span> <span class="n">string_of_data</span> <span class="o">:</span> <span class="n">data</span> <span class="o">-&gt;</span> <span class="kt">string</span> <span class="o">=</span> <span class="k">function</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>  <span class="o">|</span> <span class="nc">Asciz</span> <span class="n">s</span> <span class="o">-&gt;</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">.asciz</span><span class="se">\t</span><span class="s2">"</span> <span class="o">^</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">"</span> <span class="o">^</span> <span class="o">(</span><span class="nn">String</span><span class="p">.</span><span class="n">escaped</span> <span class="n">s</span><span class="o">)</span> <span class="o">^</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">"</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>  <span class="o">|</span> <span class="nc">Quad</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">.quad</span><span class="se">\t</span><span class="s2">"</span> <span class="o">^</span> <span class="n">string_of_imm</span> <span class="n">i</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="k">let</span> <span class="n">string_of_asm</span> <span class="o">:</span> <span class="n">asm</span> <span class="o">-&gt;</span> <span class="kt">string</span> <span class="o">=</span> <span class="k">function</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>  <span class="o">|</span> <span class="nc">Text</span> <span class="n">is</span> <span class="o">-&gt;</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">.text</span><span class="se">\n</span><span class="s2">"</span> <span class="o">^</span> <span class="n">map_concat</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span> <span class="n">string_of_ins</span> <span class="n">is</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>  <span class="o">|</span> <span class="nc">Data</span> <span class="n">ds</span> <span class="o">-&gt;</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">.data</span><span class="se">\n</span><span class="s2">"</span> <span class="o">^</span> <span class="n">map_concat</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span> <span class="n">string_of_data</span> <span class="n">ds</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="k">let</span> <span class="n">string_of_elem</span> <span class="o">{</span><span class="n">lbl</span><span class="o">;</span> <span class="n">global</span><span class="o">;</span> <span class="n">asm</span><span class="o">}</span> <span class="o">:</span> <span class="kt">string</span> <span class="o">=</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>  <span class="k">let</span> <span class="n">sec</span><span class="o">,</span> <span class="n">body</span> <span class="o">=</span> <span class="k">match</span> <span class="n">asm</span> <span class="k">with</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>    <span class="o">|</span> <span class="nc">Text</span> <span class="n">is</span> <span class="o">-&gt;</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">.text</span><span class="se">\n</span><span class="s2">"</span><span class="o">,</span> <span class="n">map_concat</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span> <span class="n">string_of_ins</span> <span class="n">is</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>    <span class="o">|</span> <span class="nc">Data</span> <span class="n">ds</span> <span class="o">-&gt;</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">.data</span><span class="se">\n</span><span class="s2">"</span><span class="o">,</span> <span class="n">map_concat</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span> <span class="n">string_of_data</span> <span class="n">ds</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>  <span class="k">in</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>  <span class="k">let</span> <span class="n">glb</span> <span class="o">=</span> <span class="k">if</span> <span class="n">global</span> <span class="k">then</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">.globl</span><span class="se">\t</span><span class="s2">"</span> <span class="o">^</span> <span class="n">string_of_lbl</span> <span class="n">lbl</span> <span class="o">^</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">in</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>  <span class="n">sec</span> <span class="o">^</span> <span class="n">glb</span> <span class="o">^</span> <span class="n">string_of_lbl</span> <span class="n">lbl</span> <span class="o">^</span> <span class="s2">":</span><span class="se">\n</span><span class="s2">"</span> <span class="o">^</span> <span class="n">body</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="k">let</span> <span class="n">string_of_prog</span> <span class="o">(</span><span class="n">p</span><span class="o">:</span><span class="n">prog</span><span class="o">)</span> <span class="o">:</span> <span class="kt">string</span> <span class="o">=</span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>  <span class="nn">String</span><span class="p">.</span><span class="n">concat</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span> <span class="o">@@</span> <span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="n">string_of_elem</span> <span class="n">p</span>
</span></code></pre></div>
<p>最后几个处理：
- <code>string_of_data</code> 在一个数据前附上标识
    - <code>.asciz</code> - <code>\0</code> 结尾的字符串
    - <code>.quad</code> - 8字节常量
- <code>string_of_asm</code> 在一个 asm 汇编段前附上标识==（但是这个真的被调用了吗？存疑）==
    - <code>.text</code> 标识代码段的开始，这个标识符常在汇编代码的开头或函数定义之前
    - <code>.data</code> 标识数据段的开始，这一段含有全局变量和静态数据<code>-</code>string_of_elem<code>将（带有标签和是否全局标志）汇编元素转换为字符串
-</code>string_of_prog` 将整个程序连接起来</p>
<hr>
<h4 id="examples">Examples</h4>
<div class="language-ocaml highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c">(* This module defines some convenient notations that can help when </span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="c"> * writing x86 assembly AST by hand. *)</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="k">module</span> <span class="nc">Asm</span> <span class="o">=</span> <span class="k">struct</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>  <span class="k">let</span> <span class="o">(~$)</span> <span class="n">i</span> <span class="o">=</span> <span class="nc">Imm</span> <span class="o">(</span><span class="nc">Lit</span> <span class="o">(</span><span class="nn">Int64</span><span class="p">.</span><span class="n">of_int</span> <span class="n">i</span><span class="o">))</span>      <span class="c">(* int64 constants *)</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>  <span class="k">let</span> <span class="o">(~$$)</span> <span class="n">l</span> <span class="o">=</span> <span class="nc">Imm</span> <span class="o">(</span><span class="nc">Lbl</span> <span class="n">l</span><span class="o">)</span>                    <span class="c">(* label constants *)</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>  <span class="k">let</span> <span class="o">(~%)</span> <span class="n">r</span> <span class="o">=</span> <span class="nc">Reg</span> <span class="n">r</span>                           <span class="c">(* registers *)</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>  <span class="c">(* helper functions for building blocks of data or code *)</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>  <span class="k">let</span> <span class="n">data</span> <span class="n">l</span> <span class="n">ds</span> <span class="o">=</span> <span class="o">{</span> <span class="n">lbl</span> <span class="o">=</span> <span class="n">l</span><span class="o">;</span> <span class="n">global</span> <span class="o">=</span> <span class="bp">true</span><span class="o">;</span> <span class="n">asm</span> <span class="o">=</span> <span class="nc">Data</span> <span class="n">ds</span> <span class="o">}</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>  <span class="k">let</span> <span class="n">text</span> <span class="n">l</span> <span class="n">is</span> <span class="o">=</span> <span class="o">{</span> <span class="n">lbl</span> <span class="o">=</span> <span class="n">l</span><span class="o">;</span> <span class="n">global</span> <span class="o">=</span> <span class="bp">false</span><span class="o">;</span> <span class="n">asm</span> <span class="o">=</span> <span class="nc">Text</span> <span class="n">is</span> <span class="o">}</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>  <span class="k">let</span> <span class="n">gtext</span> <span class="n">l</span> <span class="n">is</span> <span class="o">=</span> <span class="o">{</span> <span class="n">lbl</span> <span class="o">=</span> <span class="n">l</span><span class="o">;</span> <span class="n">global</span> <span class="o">=</span> <span class="bp">true</span><span class="o">;</span> <span class="n">asm</span> <span class="o">=</span> <span class="nc">Text</span> <span class="n">is</span> <span class="o">}</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="k">end</span>
</span></code></pre></div>
<p>在开始之前，我们定义了一个 <code>Asm</code> 模块，它可以实现以下 shorthands：
- <code>~$42</code> - 快速 <code>int64</code> 常数
- <code>~$$"lbl"</code> - 快速 <code>label</code>
- <code>~%Rax</code> - 快速寄存器
- <code>data</code>, <code>text</code>, <code>gtext</code> - 快速包装为汇编元素</p>
<p>另外，OCaml 也有类似于 <code>using Asm</code> 的用法：即 <code>Asm.[ ... ]</code></p>
<hr>
<div class="language-ocaml highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c">(* Example X86 assembly program (written as OCaml AST).</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="c">     Note: OS X does not allow "absolute" addressing (i.e. using</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="c">     Ind1 (Lbl "lbl_name") as a source operand of Movq).</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="c">     So this program causes an error when assembled using gcc.</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="c">*)</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="k">let</span> <span class="n">p1</span> <span class="o">:</span> <span class="n">prog</span> <span class="o">=</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>  <span class="nn">Asm</span><span class="p">.</span><span class="o">[</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>    <span class="n">text</span> <span class="s2">"foo"</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>        <span class="o">[</span> <span class="nc">Xorq</span><span class="o">,</span> <span class="o">[~%</span><span class="nc">Rax</span><span class="o">;</span> <span class="o">~%</span><span class="nc">Rax</span><span class="o">]</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>        <span class="o">;</span> <span class="nc">Movq</span><span class="o">,</span> <span class="o">[~$</span><span class="mi">100</span><span class="o">;</span> <span class="o">~%</span><span class="nc">Rax</span><span class="o">]</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>        <span class="o">;</span> <span class="nc">Retq</span><span class="o">,</span> <span class="bp">[]</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>        <span class="o">]</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>    <span class="o">;</span> <span class="n">gtext</span> <span class="s2">"_program"</span> 
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>        <span class="o">[</span> <span class="nc">Xorq</span><span class="o">,</span> <span class="o">[~%</span><span class="nc">Rax</span><span class="o">;</span> <span class="o">~%</span><span class="nc">Rax</span><span class="o">]</span>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>        <span class="o">;</span> <span class="nc">Movq</span><span class="o">,</span> <span class="o">[</span><span class="nc">Ind1</span> <span class="o">(</span><span class="nc">Lbl</span> <span class="s2">"baz"</span><span class="o">);</span> <span class="o">~%</span><span class="nc">Rax</span><span class="o">]</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>        <span class="o">;</span> <span class="nc">Retq</span><span class="o">,</span> <span class="bp">[]</span>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>        <span class="o">]</span>
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>    <span class="o">;</span> <span class="n">data</span> <span class="s2">"baz"</span>  <span class="o">[</span><span class="nc">Quad</span> <span class="o">(</span><span class="nc">Lit</span> <span class="mi">99</span><span class="n">L</span><span class="o">)]</span>
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>    <span class="o">;</span> <span class="n">data</span> <span class="s2">"quux"</span> <span class="o">[</span><span class="nc">Asciz</span> <span class="s2">"Hello, world!"</span><span class="o">]</span>
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a>    <span class="o">]</span>
</span></code></pre></div>
<p>一个用来测试的函数，虽然非常简单，但是笔者在构建可执行文件时遇到了 PIE 报错，也许和上文注释中 OS X 的原因一致？看看 GPT 的解释：</p>
<blockquote>
<ul>
<li>PIE（Position Independent Executable，位置无关执行文件）是一种可执行文件，它可以装载到内存中的任意位置。它使得安全特性如地址空间布局随机化（ASLR）更加有效。</li>
<li>这个错误表明正在尝试生成一个 PIE，但是目标文件中的 <code>R_X86_64_32S</code> 重定位类型不适用于 PIE。</li>
<li>解决办法是重新编译时使用 <code>-fPIE</code>（生成位置无关代码）选项。</li>
<li>它告诉编译器生成适合位置无关执行文件的代码。</li>
</ul>
</blockquote>
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>cd code &amp;&amp; dune build
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>Entering directory '/workspaces/lec04'
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>./code/main.exe &gt; test.s           
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>gcc -o test test.s runtime.c
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>/usr/bin/ld: /tmp/cc0WbUWg.o: relocation R_X86_64_32S against symbol `baz' can not be used when making a PIE object; recompile with -fPIE
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>collect2: error: ld returned 1 exit status
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>make: *** [Makefile:22: test] Error 1
</span></code></pre></div>
<p>好吧，那我们就看看下一个</p>
<hr>
<div class="language-ocaml highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c">(* This example uses "rip-relative" addressing to load the </span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="c">   global value (99L) stored at label "baz". *)</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="k">let</span> <span class="n">p2</span> <span class="o">:</span> <span class="n">prog</span> <span class="o">=</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>  <span class="nn">Asm</span><span class="p">.</span><span class="o">[</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>    <span class="n">text</span> <span class="s2">"foo"</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>      <span class="o">[</span> <span class="nc">Xorq</span><span class="o">,</span> <span class="o">[~%</span><span class="nc">Rax</span><span class="o">;</span> <span class="o">~%</span><span class="nc">Rax</span><span class="o">]</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>      <span class="o">;</span> <span class="nc">Movq</span><span class="o">,</span> <span class="o">[~$</span><span class="mi">100</span><span class="o">;</span> <span class="o">~%</span><span class="nc">Rax</span><span class="o">]</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>      <span class="o">;</span> <span class="nc">Retq</span><span class="o">,</span> <span class="bp">[]</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>      <span class="o">]</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>  <span class="o">;</span> <span class="n">gtext</span> <span class="s2">"program"</span> 
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>      <span class="o">[</span> <span class="nc">Xorq</span><span class="o">,</span> <span class="o">[~%</span><span class="nc">Rax</span><span class="o">;</span> <span class="o">~%</span><span class="nc">Rax</span><span class="o">]</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>      <span class="o">;</span> <span class="nc">Movq</span><span class="o">,</span> <span class="o">[</span><span class="nc">Ind3</span> <span class="o">(</span><span class="nc">Lbl</span> <span class="s2">"baz"</span><span class="o">,</span> <span class="nc">Rip</span><span class="o">);</span> <span class="o">~%</span><span class="nc">Rax</span><span class="o">]</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>      <span class="o">;</span> <span class="nc">Retq</span><span class="o">,</span> <span class="bp">[]</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>      <span class="o">]</span>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>  <span class="o">;</span> <span class="n">data</span> <span class="s2">"baz"</span> <span class="o">[</span><span class="nc">Quad</span> <span class="o">(</span><span class="nc">Lit</span> <span class="mi">99</span><span class="n">L</span><span class="o">)]</span>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>  <span class="o">;</span> <span class="n">data</span> <span class="s2">"quux"</span> <span class="o">[</span><span class="nc">Asciz</span> <span class="s2">"Hello, world!"</span><span class="o">]</span>
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>  <span class="o">]</span>
</span></code></pre></div>
<p>最大的区别是将 <code>Ind1 (Lbl "baz")]</code> 改成了 <code>Ind3 (Lbl "baz", Rip)</code>，在生成的汇编中由 <code>movq  baz, %rax</code> 改为了 <code>movq    baz(%rip), %rax</code>。</p>
<p>让我们来分析：</p>
<ul>
<li>首先，进入 <code>foo</code> 函数段<ul>
<li>对 Rax 寄存器进行自我 <code>xor</code> 操作，是一个常见的清零。</li>
<li>将 100 赋值 Rax</li>
<li>返回</li>
</ul>
</li>
<li>进入 <code>_program</code> 函数段<ul>
<li>清零</li>
<li>在第一份代码中，会生成 <code>movq baz, %rax</code> 将标签 <code>baz</code> 对应的地址移动到 Rax，是绝对寻址</li>
<li>而在第二份代码中，会生成 <code>movq    baz(%rip), %rax</code> 将标签 <code>baz</code> 计算偏移量之后的地址移动到 Rax ，是相对寻址</li>
</ul>
</li>
<li>后续两个数据段不做赘述</li>
</ul>
<p>需要注意的是，前者的绝对寻址时，汇编程序在组装和链接时已经知道 <code>baz</code> 在内存中的确切位置，并会在指令中嵌入这个地址。而绝对寻址在位置无关可执行文件 (PIE) 时可能会产生重定位问题（现代操作系统通常会启用地址空间布局随机化（ASLR）等安全策略，所以每次程序会被加载到随机的地址），因为绝对地址在不同的加载位置可能会改变。<br>
在 x86 架构中，相对寻址是基于指令指针 <code>%rip</code> 的偏移地址计算的。因此，相对地址是相对于当前执行代码的位置计算的。<br>
相对寻址允许生成位置无关代码 (PIC)，这种代码可以加载到内存中的不同位置而无需重定位修改。</p>
<hr>
<div class="language-ocaml highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c">(* This x86 program computes [n] factorial via a loop.</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="c">   Note that the argument [n] is a meta-level variable.</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="c">   That means that p3 is really a "template" that, given</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="c">   an OCaml integer [n] produces assembly code to </span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="c">   compute [n] factorial.</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="c">*)</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="k">let</span> <span class="n">p3</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="kt">int</span><span class="o">)</span> <span class="o">:</span> <span class="n">prog</span> <span class="o">=</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>  <span class="nn">Asm</span><span class="p">.</span><span class="o">[</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>    <span class="n">gtext</span> <span class="s2">"program"</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>      <span class="o">[</span> <span class="nc">Movq</span><span class="o">,</span>  <span class="o">[~$</span><span class="mi">1</span><span class="o">;</span> <span class="o">~%</span><span class="nc">Rax</span><span class="o">]</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>      <span class="o">;</span> <span class="nc">Movq</span><span class="o">,</span>  <span class="o">[~$</span><span class="n">n</span><span class="o">;</span> <span class="o">~%</span><span class="nc">Rdi</span><span class="o">]</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>      <span class="o">]</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>  <span class="o">;</span> <span class="n">text</span> <span class="s2">"loop"</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>      <span class="o">[</span> <span class="nc">Cmpq</span><span class="o">,</span>  <span class="o">[~$</span><span class="mi">0</span><span class="o">;</span> <span class="o">~%</span><span class="nc">Rdi</span><span class="o">]</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>      <span class="o">;</span> <span class="nc">J</span> <span class="nc">Eq</span><span class="o">,</span>  <span class="o">[~$$</span><span class="s2">"exit"</span><span class="o">]</span>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>      <span class="o">;</span> <span class="nc">Imulq</span><span class="o">,</span> <span class="o">[~%</span><span class="nc">Rdi</span><span class="o">;</span> <span class="o">~%</span><span class="nc">Rax</span><span class="o">]</span>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>      <span class="o">;</span> <span class="nc">Decq</span><span class="o">,</span>  <span class="o">[~%</span><span class="nc">Rdi</span><span class="o">]</span>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>      <span class="o">;</span> <span class="nc">Jmp</span><span class="o">,</span>   <span class="o">[~$$</span><span class="s2">"loop"</span><span class="o">]</span>
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>      <span class="o">]</span>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>  <span class="o">;</span> <span class="n">text</span> <span class="s2">"exit"</span>
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a>      <span class="o">[</span> <span class="nc">Retq</span><span class="o">,</span>  <span class="bp">[]</span> 
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>      <span class="o">]</span>
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a>  <span class="o">]</span>
</span></code></pre></div>
<p>这里不多做赘述，可以看之前的分析。</p>
<hr>
<div class="language-ocaml highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c">(* This x86 program computes [n] factorial via recursion.</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="c">   As above, [n] is a meta-level argument.</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="c">*)</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="k">let</span> <span class="n">p4</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="kt">int</span><span class="o">)</span> <span class="o">:</span> <span class="n">prog</span> <span class="o">=</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>  <span class="nn">Asm</span><span class="p">.</span><span class="o">[</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>    <span class="n">text</span> <span class="s2">"fac"</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>      <span class="o">[</span> <span class="nc">Movq</span><span class="o">,</span>  <span class="o">[~%</span><span class="nc">Rsi</span><span class="o">;</span> <span class="o">~%</span><span class="nc">Rax</span><span class="o">]</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>      <span class="o">;</span> <span class="nc">Cmpq</span><span class="o">,</span>  <span class="o">[~$</span><span class="mi">1</span><span class="o">;</span> <span class="o">~%</span><span class="nc">Rdi</span><span class="o">]</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>      <span class="o">;</span> <span class="nc">J</span> <span class="nc">Eq</span><span class="o">,</span>  <span class="o">[~$$</span><span class="s2">"exit"</span><span class="o">]</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>      <span class="o">;</span> <span class="nc">Imulq</span><span class="o">,</span> <span class="o">[~%</span><span class="nc">Rdi</span><span class="o">;</span> <span class="o">~%</span><span class="nc">Rsi</span><span class="o">]</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>      <span class="o">;</span> <span class="nc">Decq</span><span class="o">,</span>  <span class="o">[~%</span><span class="nc">Rdi</span><span class="o">]</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>      <span class="o">;</span> <span class="nc">Callq</span><span class="o">,</span> <span class="o">[~$$</span><span class="s2">"fac"</span><span class="o">]</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>      <span class="o">]</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>  <span class="o">;</span> <span class="n">text</span> <span class="s2">"exit"</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>      <span class="o">[</span> <span class="nc">Retq</span><span class="o">,</span>  <span class="bp">[]</span> <span class="o">]</span>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>  <span class="o">;</span> <span class="n">gtext</span> <span class="s2">"program"</span>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>      <span class="o">[</span> <span class="nc">Movq</span><span class="o">,</span>  <span class="o">[~$</span><span class="n">n</span><span class="o">;</span> <span class="o">~%</span><span class="nc">Rdi</span><span class="o">]</span>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a>      <span class="o">;</span> <span class="nc">Movq</span><span class="o">,</span>  <span class="o">[~$</span><span class="mi">1</span><span class="o">;</span> <span class="o">~%</span><span class="nc">Rsi</span><span class="o">]</span>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a>      <span class="o">;</span> <span class="nc">Callq</span><span class="o">,</span> <span class="o">[~$$</span><span class="s2">"fac"</span><span class="o">]</span>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a>      <span class="o">;</span> <span class="nc">Retq</span><span class="o">,</span>  <span class="bp">[]</span>
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a>      <span class="o">]</span>
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a>  <span class="o">]</span>
</span></code></pre></div>
<p>与 p3 不同，这里用的是递归的方式，也就是说，函数的“循环”操作不再依赖 <code>jmp</code>，而是用 <code>call</code> （虽然本质上都是改变 rip，但是调用函数需要有栈的操作）<br>
虽然这里的栈的操作看起来是多余的，但是向我们展示了 <code>call</code> 的用法</p>
<h3 id="programming-in-x86lite-storage">Programming in X86lite - Storage</h3>
<p>基本的 C 内存模型包含三个部分，地址从高到低分别为</p>
<ul>
<li>Stack<ul>
<li>存储局部变量</li>
<li>存储函数 return 的地址</li>
</ul>
</li>
<li>Heap<ul>
<li>存储<strong>动态分配</strong>的对象</li>
<li>通过 <code>malloc</code>, <code>free</code> 分配和释放</li>
<li>由 C runtime system 管理</li>
</ul>
</li>
<li>Code &amp; data (and text)<ul>
<li>包括编译后的代码，字符串常量等</li>
</ul>
</li>
</ul>
<p>我们可能需要存储全局变量、函数参数、（原先或者编译器定义的）局部变量。我们可以存储到快速但空间小的 Register 或者慢速但空间大的 Memory（或者 Cache）。在 X86 的实践中， Reg 有限，而 Mem 被划分为了很多带有堆栈的小区域。</p></div>

    
      






  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">February 26, 2025 22:50:06</span>
  </span>

    
    
    
    
  </aside>

    

                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../Compilers.Lec.3/" class="md-footer__link md-footer__link--prev" aria-label="Previous: 编译原理 - Lecture 3">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                编译原理 - Lecture 3
              </div>
            </div>
          </a>
        
        
          
          <a href="../../DiscreteMathematics/DM.00%20Intro/" class="md-footer__link md-footer__link--next" aria-label="Next: Intro">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Intro
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/HeZeBang" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.zhihu.com/people/ZAMBAR" target="_blank" rel="noopener" title="www.zhihu.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M170.54 148.13v217.54l23.43.01 7.71 26.37 42.01-26.37h49.53V148.13zm97.75 193.93h-27.94l-27.9 17.51-5.08-17.47-11.9-.04V171.75h72.82zm-118.46-94.39H97.5c1.74-27.1 2.2-51.59 2.2-73.46h51.16s1.97-22.56-8.58-22.31h-88.5c3.49-13.12 7.87-26.66 13.12-40.67 0 0-24.07 0-32.27 21.57-3.39 8.9-13.21 43.14-30.7 78.12 5.89-.64 25.37-1.18 36.84-22.21 2.11-5.89 2.51-6.66 5.14-14.53h28.87c0 10.5-1.2 66.88-1.68 73.44H20.83c-11.74 0-15.56 23.62-15.56 23.62h65.58C66.45 321.1 42.83 363.12 0 396.34c20.49 5.85 40.91-.93 51-9.9 0 0 22.98-20.9 35.59-69.25l53.96 64.94s7.91-26.89-1.24-39.99c-7.58-8.92-28.06-33.06-36.79-41.81L87.9 311.95c4.36-13.98 6.99-27.55 7.87-40.67h61.65s-.09-23.62-7.59-23.62zm412.02-1.6c20.83-25.64 44.98-58.57 44.98-58.57s-18.65-14.8-27.38-4.06c-6 8.15-36.83 48.2-36.83 48.2zm-150.09-59.09c-9.01-8.25-25.91 2.13-25.91 2.13s39.52 55.04 41.12 57.45l19.46-13.73s-25.67-37.61-34.66-45.86h-.01zM640 258.35c-19.78 0-130.91.93-131.06.93v-101c4.81 0 12.42-.4 22.85-1.2 40.88-2.41 70.13-4 87.77-4.81 0 0 12.22-27.19-.59-33.44-3.07-1.18-23.17 4.58-23.17 4.58s-165.22 16.49-232.36 18.05c1.6 8.82 7.62 17.08 15.78 19.55 13.31 3.48 22.69 1.7 49.15.89 24.83-1.6 43.68-2.43 56.51-2.43v99.81H351.41s2.82 22.31 25.51 22.85h107.94v70.92c0 13.97-11.19 21.99-24.48 21.12-14.08.11-26.08-1.15-41.69-1.81 1.99 3.97 6.33 14.39 19.31 21.84 9.88 4.81 16.17 6.57 26.02 6.57 29.56 0 45.67-17.28 44.89-45.31v-73.32h122.36c9.68 0 8.7-23.78 8.7-23.78z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://space.bilibili.com/156494172" target="_blank" rel="noopener" title="space.bilibili.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M488.6 104.1c16.7 18.1 24.4 39.7 23.3 65.7v202.4c-.4 26.4-9.2 48.1-26.5 65.1-17.2 17-39.1 25.9-65.5 26.7H92.02c-26.45-.8-48.21-9.8-65.28-27.2C9.682 419.4.767 396.5 0 368.2V169.8c.767-26 9.682-47.6 26.74-65.7C43.81 87.75 65.57 78.77 92.02 78h29.38L96.05 52.19c-5.75-5.73-8.63-13-8.63-21.79 0-8.8 2.88-16.06 8.63-21.797C101.8 2.868 109.1 0 117.9 0q13.2 0 21.9 8.603L213.1 78h88l74.5-69.397C381.7 2.868 389.2 0 398 0q13.2 0 21.9 8.603c5.7 5.737 8.6 12.997 8.6 21.797 0 8.79-2.9 16.06-8.6 21.79L394.6 78h29.3c26.4.77 48 9.75 64.7 26.1m-38.8 69.7c-.4-9.6-3.7-17.4-10.7-23.5-5.2-6.1-14-9.4-22.7-9.8H96.05c-9.59.4-17.45 3.7-23.58 9.8-6.14 6.1-9.4 13.9-9.78 23.5v194.4c0 9.2 3.26 17 9.78 23.5s14.38 9.8 23.58 9.8H416.4c9.2 0 17-3.3 23.3-9.8s9.7-14.3 10.1-23.5zm-264.3 42.7c6.3 6.3 9.7 14.1 10.1 23.2V273c-.4 9.2-3.7 16.9-9.8 23.2-6.2 6.3-14 9.5-23.6 9.5s-17.5-3.2-23.6-9.5-9.4-14-9.8-23.2v-33.3c.4-9.1 3.8-16.9 10.1-23.2s13.2-9.6 23.3-10c9.2.4 17 3.7 23.3 10m191.5 0c6.3 6.3 9.7 14.1 10.1 23.2V273c-.4 9.2-3.7 16.9-9.8 23.2s-14 9.5-23.6 9.5-17.4-3.2-23.6-9.5c-7-6.3-9.4-14-9.7-23.2v-33.3c.3-9.1 3.7-16.9 10-23.2s14.1-9.6 23.3-10c9.2.4 17 3.7 23.3 10"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:<email-address>" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480v-83.6c0-4 1.5-7.8 4.2-10.8l167.6-182.8c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8l-88.3-44.2C7.1 311.3.3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.top", "navigation.tabs", "navigation.footer", "navigation.instant", "navigation.instant.progress"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
    
  </body>
</html>